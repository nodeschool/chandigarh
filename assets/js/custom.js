!function(a){function k(){e=b.height(),l()}function l(){var c=b.scrollTop();if(c){var h,g=d.length;if(g){var k,l,n,o,p=[];for(h=0;g>h;h++)if(k=d[h],o=k.attr("height"),l=k.offset().top,c+e>=l&&l+parseInt(o,10)>=c){var q=k.parent().css({width:k.attr("width"),height:o}).addClass("img-loading"),r=a('<img class="img-new img-replace" />').data("par",q).one("load",m).insertAfter(k);r.attr("src",k.attr("data-src")),p[p.length]=k}for(g=p.length,h=0;g>h;h++)n=d.indexOf(p[h]),-1!==n&&d.splice(n,1)}var s,t,u;for(j.removeClass("active"),h=0;i>h;h++)if(s=f[h],t=s.outerHeight(!0),u=s.offset().top,c>=u-300&&u+t-300>=c){a(".nav a[href=#"+s.attr("id")+"]").parent().addClass("active");break}}}function m(){var b=a(this);b.data("par").removeClass("img-loading"),b.removeData("par").removeClass("img-replace")}function n(b){j.removeClass("active"),b&&"click"===b.type?a(this).addClass("active"):(c=location.hash,c&&(a(".nav a[href="+c+"]").parent().addClass("active"),g?(g=!1,setTimeout(o,500)):o())),l()}function o(){a(c)[0].scrollIntoView()}var b,c,d,e,f=[],g=!0,h=a("section"),i=h.length,j=a(".nav li").on("click",n);h.each(function(b){f[b]=a(this)}),a(document).ready(function(){d=[],a("img").each(function(b){d[b]=a(this)}),b=a(window).on("hashchange",n).on("scroll",l).on("resize",k),n(),k()})}(jQuery);